<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" type="text/css" href="styles.css" />
    <link rel="stylesheet" href="bootstrap.css" />
    <style>
      #audio-wave {
        width: 80%;
        height: 100%x;
        border: 1px solid black;
      }
    </style>
  </head>
  <body class="h-100">
    <header id="header" class="bg-black">header</header>
    <div id="body" class="container">
      <div class="bg-info d-flex justify-content-center">
        <canvas id="audio-wave" class="row bg-black"></canvas>
      </div>
      <div id="settingForm" class="bg-danger">
        <h1>목소리 성별 선택</h1>
        <button
          type="input"
          class="btn btn-secondary disabled"
          name="gender"
          id="button1"
          onclick="toggleButton(this)"
          value="남자"
        >
          남자
        </button>
        <button
          class="btn btn-secondary"
          type="input"
          id="button2"
          name="gender"
          onclick="toggleButton(this)"
          value="여자"
        >
          여자
        </button>

        <h1>인사 시간 선택</h1>
        <form>
          <label for="morning">아침</label>
          <input value="06:00" type="time" id="morning" name="morning" /><br />

          <label for="lunch">점심</label>
          <input value="12:00" type="time" id="lunch" name="lunch" /><br />

          <label for="dinner">저녁</label>
          <input value="18:00" type="time" id="dinner" name="dinner" /><br />
        </form>
      </div>
    </div>
    <footer class="bg-black">footer</footer>

    <script>
      // 오디오 파동 모양을 보여주는 함수
      function visualizeAudio() {
        var canvas = document.getElementById("audio-wave");
        var ctx = canvas.getContext("2d");
        var waveWidth = canvas.width;
        var waveHeight = canvas.height;

        var audioContext = new (window.AudioContext ||
          window.webkitAudioContext)();
        var analyser = audioContext.createAnalyser();

        // getUserMedia를 사용하여 마이크에 접근
        navigator.mediaDevices
          .getUserMedia({ audio: true })
          .then(function (stream) {
            var source = audioContext.createMediaStreamSource(stream);
            source.connect(analyser);

            analyser.fftSize = 256;
            var bufferLength = analyser.frequencyBinCount;
            var dataArray = new Uint8Array(bufferLength);

            function draw() {
              requestAnimationFrame(draw);

              analyser.getByteTimeDomainData(dataArray);

              ctx.fillStyle = "rgba(255, 255, 255, 0.1)";
              ctx.fillRect(0, 0, waveWidth, waveHeight);
              ctx.lineWidth = 2;
              ctx.strokeStyle = "rgb(0, 0, 255)";
              ctx.beginPath();

              var sliceWidth = (waveWidth * 1.0) / bufferLength;
              var x = 0;

              for (var i = 0; i < bufferLength; i++) {
                var v = dataArray[i] / 128.0;
                var y = (v * waveHeight) / 2;

                if (i === 0) {
                  ctx.moveTo(x, y);
                } else {
                  ctx.lineTo(x, y);
                }

                x += sliceWidth;
              }

              ctx.lineTo(waveWidth, waveHeight / 2);
              ctx.stroke();
            }

            draw();
          })
          .catch(function (err) {
            console.error("마이크에 접근하는 중 오류가 발생했습니다.", err);
          });
      }

      visualizeAudio();
    </script>

    <script>
      function toggleButton(button) {
        button.classList.add("disabled"); // 클릭한 버튼을 비활성화

        // 나머지 버튼을 찾아 활성화
        var otherButtonId = button.id === "button1" ? "button2" : "button1";
        var otherButton = document.getElementById(otherButtonId);
        otherButton.classList.remove("disabled");
        otherButton.classList.add("active");
      }
    </script>

    <script src="script.js"></script>
    <script src="bootstrap.js"></script>
  </body>
</html>
